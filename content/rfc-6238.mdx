---
title: "TOTP: Time-Based One-Time Password Algorithm (RFC 6238)"
date: "2011-05-01"
---

# TOTP (Time-Based One-Time Password)

구글 OTP, 은행 OTP 등 2단계 인증(2FA)에서 쓰는 **"30초마다 바뀌는 숫자 6자리"**의 원리입니다.
놀랍게도 OTP 앱은 **인터넷 연결이 끊겨 있어도** 숫자를 잘 만들어냅니다. 어떻게 그럴까요?

---

## 1. 동작 원리 (Algorithm)

서버와 사용자의 스마트폰은 딱 하나만 공유하고 있습니다. 바로 **비밀 키(Secret Key)**입니다.
(QR 코드를 찍을 때 이 비밀 키가 스마트폰으로 넘어갑니다.)

### 마법의 공식
```
OTP 숫자 = Hash(비밀 키 + 현재 시간)
```

1.  스마트폰과 서버는 둘 다 "현재 시간"을 알고 있습니다.
2.  시간을 30초 단위로 쪼갭니다. (예: 10시 00분 00초 ~ 29초는 같은 구간)
3.  `비밀 키`와 `시간 구간`을 합쳐서 해시 함수(HMAC-SHA1)를 돌립니다.
4.  나온 결과물을 잘라서 숫자 6자리를 만듭니다.
5.  둘 다 같은 공식을 썼으니, **같은 시간엔 같은 숫자**가 나옵니다!

---

## 2. 개발 시 주의사항

*   **서버 시간 동기화 (NTP)**: 서버 시간이 틀리면 사용자 앱과 숫자가 안 맞아서 로그인 실패가 뜹니다. 서버 시간을 정확하게 유지해야 합니다.
*   **여유 시간 허용 (Window)**: 네트워크 딜레이나 사용자가 입력하는 시간을 고려해, 현재 시간의 **앞뒤 30초(총 90초 정도)**까지는 정답으로 인정해주는 것이 UX상 좋습니다.

---

## 3. 백업 코드 (Recovery Code)
스마트폰을 잃어버리면 OTP를 못 씁니다.
그래서 서비스를 만들 때는 반드시 **백업 코드(일회용 코드 10개)**를 미리 발급해주고, "따로 적어두세요"라고 안내해야 합니다.
